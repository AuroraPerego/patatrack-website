image: ruby:2.3

variables:
  JEKYLL_ENV: production



# test:
#   stage: test
#   script:
#   - bundle exec jekyll build -d test
#   artifacts:
#     paths:
#     - test
#   except:
#   - master

compilation-website:
  stage: build
  before_script:
  - bundle install
  script:
  - bundle exec jekyll build -d public
  artifacts:
    paths:
    - public
    
compilation-wiki:
  stage: build
  image: node:latest
  before_script:
  - npm install -g gitbook-cli
  - gitbook install
  script:
  - gitbook build wiki public/wiki
  dependencies:
    - compilation-website
  artifacts:
    paths:
    - public/wiki

 


pages:
  stage: deploy
  # Docker image with tools to deploy to EOS
  image: gitlab-registry.cern.ch/ci-tools/ci-web-deployer:latest
  script:
  - deploy-eos
  dependencies:
    - compilation-website
    - compilation-wiki
  only:
  - master
